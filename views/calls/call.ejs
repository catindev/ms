<%
    function isMyNewContactCall( call ) {
        return !call.contact.name &&
               ( !call.contact.user ||
                 call.contact.user._id.toString() === user._id.toString()
               );
    }
%>

<div class="call cbox">
    <div class="unrow">
        <div class="uncol" style="vertical-align: middle;">
            <div>
                <div style="font-size: 13px;line-height: 1.5;opacity: .4;">
                    <%= call.display.date %>
                </div>
                <div style="font-size: 22px; line-height: 1.5; font-weight: 400;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;">
                    <% if ( !call.contact.name) { %>
                        Новый контакт
                    <% } else { %>
                        <%= call.contact.name %>
                    <% } %>
                </div>
            </div>
        </div>
        <div class="uncol" style="vertical-align: middle; text-align: right;">

            <% if ( user.type === 'admin' ) { %>
                <a href="contacts/<%= call.contact._id %>?backURL=/"
                   class="button primary" role="button">Смотреть профиль</a>
            <% } else { %>
                <% if ( isMyNewContactCall(call) ) { %>
                    <a href="contacts/edit/<%= call.contact._id %>?backURL=/"
                       class="button primary" role="button">Заполнить профиль</a>
                <% } else { %>
                    <a href="contacts/<%= call.contact._id %>?backURL=/"
                       class="button primary" role="button">Смотреть профиль</a>
                <% } %>
            <% } %>
        </div>
    </div>

    <% if ( call.recordFile ) { %>
    <div class="unrow" style="padding: .5rem 0;">
        <audio controls="" style="width: 100%">
            <source src="http://185.22.67.22<%= call.recordFile %>" type="audio/mpeg">
        </audio>
    </div>
    <% } %>

    <% if (!call.recordFile) { %>
        <div class="unrow" style="padding: .5rem .7rem; border-radius: 4px; font-size: .85rem; background: #fcf8e3; text-align: center;margin: .5rem 0;">
            Без ответа. Клиент ждал(а) <%= call.display.waiting %>
        </div>
    <% } %>

    <% if ( user.type === 'admin' ) { %>
    <div class="unrow" style="padding: .5rem .7rem; border-radius: 4px; font-size: .85rem; background: #eee; margin-bottom: .5rem;">
        <%= call.account.name %>
    </div>
    <% } %>

    <div class="row between" style="text-align: center;font-size: .92rem">
        <div class="col col-3" style="padding-left: 0;">
            <%= call.contact.phone %>
        </div>
        <div class="col col-3">
            <%= call.number.name %>
        </div>
        <div class="col col-3">
            <%= call.contact.user && call.contact.user.name %>
        </div>
    </div>
</div>